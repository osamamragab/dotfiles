#!/bin/sh

set -eu

MENUS_DIR="${MENUS_DIR:-${XDG_DATA_HOME:-$HOME/.local/share}/menus}"
export MENU_PROMPT="Menu"

# TODO: remove tail pipe when https://codeberg.org/dnkl/fuzzel/issues/700 is fixed
menu="${1:-$(menu --nth-delimiter "," --with-nth 2 <"$MENUS_DIR/menus.txt" | tail -1)}" || exit 1
name="${menu#*,}"
script="${menu%,*}"

[ -x "$MENUS_DIR/$script" ] || {
	echo "$(basename "$0"): invalid menu: $name" >&2
	exit 1
}

[ $# -gt 0 ] && shift
MENU_PROMPT="$name" exec "$MENUS_DIR/$script" "$@"
