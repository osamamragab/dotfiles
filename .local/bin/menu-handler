#!/bin/sh

set -eu

MENUS_DIR="${MENUS_DIR:-${XDG_DATA_HOME:-$HOME/.local/share}/menus}"

# TODO: remove tail pipe when https://codeberg.org/dnkl/fuzzel/issues/700 is fixed
menu="${1:-$(
	menu --nth-delimiter "," --with-nth 2 -p "Menu> " <<-_EOF | tail -1
		input, Input Handler
		recents, Recent Files
		clipboard, Clipboard History
		bookmarks, Bookmarks
		emojis, Emojis
		pass, Passwords
		pass-otp, Passwords OTP
		screenshot, Screenshot
		screenrec, Screen Recording
		display-profiles, Display Profiles
		sysact, Power Menu
	_EOF
)}" || exit 1
name="${menu#*,}"
script="${menu%,*}"

[ -x "$MENUS_DIR/$script" ] || {
	echo "$(basename "$0"): invalid menu: $name" >&2
	exit 1
}

[ $# -gt 0 ] && shift
MENU_PROMPT="$name> " exec "$MENUS_DIR/$script" "$@"
