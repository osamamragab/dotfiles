#!/bin/sh

set -eu

# shellcheck disable=2015
sudocmd="$([ -f /etc/doas.conf ] && command -v doas 2>/dev/null || command -v sudo 2>/dev/null)"

updatepkgs() {
	$sudocmd xbps-install -Sy &&
		$sudocmd xbps-install -uy xbps &&
		$sudocmd xbps-install -uy
	command -v mise >/dev/null 2>&1 && mise upgrade -y
	command -v flatpak >/dev/null 2>&1 && flatpak update -y
	command -v xlocate >/dev/null 2>&1 && xlocate -S
	command -v xcheckrestart >/dev/null 2>&1 && xcheckrestart
	return 0
}

clean() {
	$sudocmd xbps-remove -Ooy
	$sudocmd vkpurse rm all
}

case "${1:-pkgs}" in
	pkgs) updatepkgs ;;
	clean) clean ;;
	*)
		echo "$(basename "$0"): unknown command: $1" >&2
		exit 1
		;;
esac
