#!/bin/sh

run() {
	! pidof -s redshift >/dev/null 2>&1 &&
		setsid -f redshift -P -O 4500 -g 0.95 >/dev/null 2>&1
	! pidof -s safeeyes >/dev/null 2>&1 &&
		setsid -f safeeyes -e >/dev/null 2>&1
}

quit() {
	redshift -x >/dev/null 2>&1
	safeeyes -q >/dev/null 2>&1
	pkill redshift >/dev/null 2>&1
}

case "$1" in
	-t)
		f="/tmp/.ohmyeyes"
		if [ -f "$f" ]; then
			quit
			rm "$f"
			exit 0
		fi
		run
		touch "$f"
		;;
	-q) quit ;;
	*) run ;;
esac
