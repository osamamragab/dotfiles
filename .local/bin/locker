#!/bin/sh

case "$1" in
	""|lock)
		pidof -s slock >/dev/null 2>&1 && exit 0
		trap "pidof -s xcompmgr || setsid -f xcompmgr" EXIT
		pkill xcompmgr >/dev/null 2>&1
		playerctl -i mpd pause >/dev/null 2>&1
		[ $# -gt 0 ] && [ "$1" = "lock" ] && shift
		while ! slock "$@"; do
			sleep 0.5
		done
		;;
	dim)
		brillo -O
		brillo -S "${2:-10}" -u 200
		trap "brillo -I" EXIT TERM INT
		sleep 2147483647 &
		wait
		;;
	sleep)
		slock loginctl suspend -i
		;;
	enable)
		xset +dpms
		xset s on
		;;
	disable)
		xset -dpms
		xset s off
		;;
	stayup)
		trap "xset +dpms; xset s on" EXIT
		xset -dpms
		xset s off
		pause
		;;
	*)
		echo "$(basename "$0"): unknown command $1" >&2
		exit 1
		;;
esac
