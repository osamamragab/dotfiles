#!/bin/sh

case "$1" in
	""|lock)
		pidof -s slock >/dev/null 2>&1 && exit 0
		trap "pidof -s xcompmgr || setsid -f xcompmgr" EXIT
		pkill xcompmgr >/dev/null 2>&1
		playerctl -i mpd pause >/dev/null 2>&1
		[ $# -gt 0 ] && [ "$1" = "lock" ] && shift
		while ! slock "$@"; do
			sleep 0.5
		done
		;;
	dim)
		trap "exit 0" TERM INT
		# shellcheck disable=SC2064
		trap "xbacklight -steps 1 -set $(xbacklight -get); kill \$!" EXIT
		xbacklight -time 200 -steps 20 -set "${2:-0}"
		sleep 2147483647 &
		wait
		;;
	sleep)
		slock loginctl suspend -i
		;;
	enable)
		xset +dpms
		xset s on
		;;
	disable)
		xset -dpms
		xset s off
		;;
	stayup)
		trap "xset +dpms; xset s on" EXIT
		xset -dpms
		xset s off
		pause
		;;
	*)
		echo "$(basename "$0"): unknown command $1" >&2
		exit 1
		;;
esac
