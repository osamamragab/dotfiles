#!/bin/sh

filename="${JOURNALDIR:-$HOME/.local/share/journal}/$(date '+%Y-%m-%d').md"

if [ "$1" ]; then
	case "$1" in
		-e|e|edit)
			$EDITOR "$filename"
			;;
		-r|r|read)
			[ -s "$filename" ] || (echo "$(basename "$0"): today's journal is empty" >&2; exit 1)
			if command -v glow >/dev/null 2>&1; then
				glow -p "$filename"
			elif command -v pandoc >/dev/null 2>&1 && command -v lynx >/dev/null 2>&1; then
				pandoc -t html "$filename" | lynx -stdin
			else
				$EDITOR -R "$filename"
			fi
			;;
		*)
			echo "$(basename "$0"): unknown option $1" >&2
			exit 1
			;;
	esac
	exit 0
fi

[ -s "$filename" ] || printf "# %s\n\n" "$(date '+%Y %B %d')" > "$filename"
$EDITOR "$filename" +$
