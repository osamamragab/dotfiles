#!/bin/sh

if [ ! -d /sys/class/power_supply ] || [ -z "$(ls -A /sys/class/power_supply)" ]; then
	echo "!"
	exit 1
fi

for bat in /sys/class/power_supply/BAT?*; do
	cap="$(cat "$bat/capacity" 2>&1)"
	case "$(cat "$bat/status" 2>&1)" in
		"Full") icon="🟢" ;;
		"Charging") icon="⚡" ;;
		"Discharging")
				[ "$cap" -le 15 ] && icon="❗"
				[ "$cap" -eq 15 ] && [ "$(dunstctl count displayed 2>/dev/null)" -eq 0 ] &&
					notify-send -u critical -a "$(basename "$0")" "battery is too low" "please charge this device"
			;;
		"Not charging") icon="🛑" ;;
		"Unknown") status="♻️" ;;
	esac
	[ "$icon" ] && echo "$cap% $icon" || echo "$cap%"
done
