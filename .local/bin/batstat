#!/bin/sh

if [ -z "$(ls -A /sys/class/power_supply/BAT?* 2>/dev/null)" ]; then
	echo "â€”"
	exit 1
fi

for bat in /sys/class/power_supply/BAT?*; do
	cap="$(cat "$bat/capacity")"
	stat="$(cat "$bat/status")"

	case "$stat" in
		Full|Charging)
			[ -f /tmp/batstat-low_warning ] && rm -f /tmp/batstat-low_warning
			;;
		*)
			[ "$cap" -le 15 ] &&
				[ ! -f /tmp/batstat-low_warning ] &&
				notify-send -u critical -a "$(basename "$0")" "battery is too low" "please charge this device" &&
				touch /tmp/batstat-low_warning
			;;
	esac

	case "$stat" in
		Full) icon="ðŸŸ¢" ;;
		Charging) icon="âš¡" ;;
		Discharging) [ "$cap" -le 15 ] && icon="â—" ;;
		"Not charging") icon="ðŸ›‘" ;;
		Unknown) icon="â™»ï¸" ;;
	esac

	[ "$icon" ] && echo "$cap% $icon" || echo "$cap%"
done 2>/dev/null
