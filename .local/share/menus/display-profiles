#!/bin/sh

set -eu

XDG_CONFIG_HOME="${XDG_CONFIG_HOME:-$HOME/.config}"
[ -r "$XDG_CONFIG_HOME/kanshi/config" ] || {
	echo "$(basename "$0"): cannot read kanshi config: $XDG_CONFIG_HOME/kanshi/config" >&2
	exit 1
}

command -v kanshictl >/dev/null 2>&1 || {
	echo "$(basename "$0"): kanshictl: command not found" >&2
	exit 1
}

display="$(sed -n "s/^\(\s\+\)\{0,1\}profile\(\s\+\)\{0,1\}\(.*\)\(\s\+\)\{0,1\}{/\3/p" <"$XDG_CONFIG_HOME/kanshi/config" | menu -p "display profile> ")" || exit 1
kanshictl reload || exit $?
exec kanshictl switch "$display"
