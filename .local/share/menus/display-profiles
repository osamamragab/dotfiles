#!/bin/sh

set -eu

export MENU_PROMPT="${MENU_PROMPT:-Display Profiles}"

XDG_CONFIG_HOME="${XDG_CONFIG_HOME:-$HOME/.config}"
[ -r "$XDG_CONFIG_HOME/kanshi/config" ] || {
	echo "$(basename "$0"): cannot read kanshi config: $XDG_CONFIG_HOME/kanshi/config" >&2
	exit 1
}

command -v kanshictl >/dev/null 2>&1 || {
	echo "$(basename "$0"): kanshictl: command not found" >&2
	exit 1
}

display="$(sed -n "s/^profile\s\+\(.*\)\s\+{/\1/p" <"$XDG_CONFIG_HOME/kanshi/config" | menu)" || exit 1
kanshictl reload || exit $?
exec kanshictl switch "$display"
