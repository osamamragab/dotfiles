#!/bin/sh

HERE="$(dirname "$(readlink -f "$0")")"
sudocmd="$(command -v doas 2>/dev/null || command -v sudo 2>/dev/null)"

if [ "$1" = "clean" ]; then
	cd "$HERE" || exit 1
	find .config .local -type f -printf "removed '$HOME/%p'\n" -exec rm -f "$HOME/{}" \;
	find "$HOME" -maxdepth 1 -xtype l -printf "removed '%p'\n" -exec rm -f "{}" \;
	"$sudocmd" find /etc/X11/xorg.conf.d -xtype l -printf "removed '%p'\n" -exec rm -f {} \;
	exit 0
fi

cp -srfv "$HERE/.config" "$HERE/.local" "$HOME"
ln -sfv "${XDG_CONFIG_HOME:-$HOME/.config}/shell/profile" "$HOME/.zprofile"
"$sudocmd" cp -srfv "${XDG_CONFIG_HOME:-$HOME/.config}/x11/xorg.conf.d" /etc/X11/
